{ "_id":"_design/accounts"
  ,"language":"javascript"
  ,"views":{
     "listing":{
       "map":"function(doc) { emit(doc.acct_id, null); }"
       ,"reduce":"function(k, vs) { return true;}"
      }
     ,"balance":{
        "map": "function(doc) { var trunks = doc.trunks || 0; var amt = doc.amount || 0; if ( doc.type == 'debit' ) { emit(doc.acct_id, {\"trunks\": trunks * -1, \"credit\": amt * -1}); } else if ( doc.type == 'credit' ) { emit(doc.acct_id, {\"trunks\": trunks, \"credit\": amt}); } else return; }"
       ,"reduce": "function(k, vs) { var totT = 0, totA = 0; vs.forEach(function(T) { totT += T.trunks; totA += T.credit; }); return {\"trunks\": totT, \"credit\": totA}; }"
      }
    }
}

