LOG=/tmp/{{ server._id }}-$(date +%s).log && echo "# knife data bag from file accounts {{ databag_path }}" > $LOG && knife data bag from file accounts {{ databag_path }} >> $LOG && sleep 10 && echo "# knife role from file {{ role_path }}" >> $LOG && knife role from file {{ role_path }} >> $LOG && sleep 10 && echo "# knife bootstrap {{ server.ip }} -p {{ server.ssh_port }} -x root -P {{ server.password }} -N {{ server.hostname }} -d {{ server.os }} -r role[{{ account._id }}],{% if "winkstart_deploy_whapps" in server.roles %}role[winkstart_deploy_haproxy],{% endif %}{% for role in server.roles %}role[{{ role }}],{% endfor %}{% if "winkstart_deploy_whapps" in server.roles %}recipe[whistle::ecallmgr_start],recipe[whistle::whapps_start],{% endif %}recipe[chef-client::first_start]" >> $LOG && knife bootstrap {{ server.ip }} -p {{ server.ssh_port }} -x root -P {{ server.password }} -N {{ server.hostname }} -d {{ server.os }} -r role[{{ account._id }}],{% if "winkstart_deploy_whapps" in server.roles %}role[winkstart_deploy_haproxy],{% endif %}{% for role in server.roles %}role[{{ role }}],{% endfor %}{% if "winkstart_deploy_whapps" in server.roles %}recipe[whistle::ecallmgr_start],recipe[whistle::whapps_start],{% endif %}recipe[chef-client::first_start] >> $LOG 
